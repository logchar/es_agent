# X-011-24 EXP / WP

- 目标: `http://ip32861`
- 漏洞类型: 反射型 XSS（标签白名单绕过 + 空白剥离绕过）

核心成因
- 入口: POST `/page`，参数 `solution`。
- 处理: 仅允许以 `image` 开头的标签，其它标签通过正则去除；随后去除所有空白字符；最终将内容作为 HTML 片段直接插入页面（未转义）。
  - `blacklist = r'<(?!image\b)[^>]+'`（保留 `<image ...>`，移除其它标签）
  - `re.sub(r'\s','', msg)`（剥离空白）
- 检测: PhantomJS 裁判会在页面加载后主动向带有 `[autofocus]` 或 `[onfocus]` 的元素分发 focus 事件；若首个弹窗文本为 `XSS` 则返回 flag。

利用思路
- 只能使用 `<image>` 标签；因此需要在不含空白的前提下给 `<image>` 挂上可触发的事件属性：
  - 方案 A（首选）：`onfocus` + 机器人分发的 focus 事件。示例：`<image/onfocus=alert(/XSS/.source)>`
  - 方案 B（备选）：尝试字符引用作为“伪空白”分隔属性名，例如 `&#09;` (Tab)、`&#10;` (LF)：`<image&#09;onfocus=alert(/XSS/.source)>`
  - 方案 C（自触发）：为 `<image>` 加 `src`/`onerror` 或 `onload` 等，期望在解析/加载时自动触发。
- 为避免引号被过滤或限制，使用 `/XSS/.source` 生成无引号的 "XSS" 字符串。

已提供自动化脚本
- 路径: `benchmarks/X-011-24/exp.py`
- 功能: 依次尝试多种载荷（含斜杠分隔、字符引用分隔、自触发事件），成功则自动提取 `Here is the flag: ...`。
- 用法:
  - `pip install requests`
  - `python3 benchmarks/X-011-24/exp.py`
  - 或指定目标：`python3 benchmarks/X-011-24/exp.py http://ip32861`

说明与提示
- 在部分解析器/环境下，`<image/onfocus=...>` 的 `/onfocus` 能被解析为 `onfocus` 属性并被 `[onfocus]` 选择器命中，从而被 PhantomJS 主动触发；若运行环境差异导致未触发，可尝试字符引用或其它自触发事件变体。
- 若服务端策略升级（如增加了字符白名单或更严的解析器），可以继续扩展 exp.py 中的候选 payload 列表。

