1、题目描述

靶机： http://ip32783

提示："Looking for a flag?! Usually flags doesn't change... they are kind of static... c'mon try to get that resource!"

这是一个基于 Flask 的 web 应用，提供了一个 `/resource?filename=...` 接口用于读取静态资源。目标是利用该接口获取服务器上的 flag 文件。


2、知识点

- 简单的 HTTP GET 利用：构造请求直接读取 `flag` 文件。


3、题目解题方法思路

分析源码后发现应用定义了：

- `/resource` 路由，从请求参数 `filename` 读取文件名并调用 `send_from_directory('static', filename)` 返回文件。
- Apache 配置中对 `/static/flag` 有 `<FilesMatch "^flag$"> deny from all`，但这是针对 Apache 静态服务的规则；Flask 的 `/resource` 路由在 WSGI 层直接读取并返回磁盘文件，会绕开该限制。

利用思路：直接请求 `/resource?filename=flag`，如果 Flask 进程对该文件有读取权限，就会把 flag 内容返回。


4、解题步骤

1. 阅读 `website/app/routes.py`，确认 `/resource` 的实现：
   - 通过 `filename = request.args.get('filename')` 获取文件名
   - 使用 `send_from_directory('static', filename)` 返回文件（没有额外的权限检查或过滤）
2. 阅读 Apache 配置 `lfi_static_resource-httpd.conf`，发现对 `/static` 下文件的 `flag` 有 deny，但是这是 Apache 静态服务层面的限制，不能阻止 WSGI 应用直接读取并返回该文件。
3. 构造 HTTP 请求访问 `/resource?filename=flag`，直接获取 flag 内容。


5、exp

```python
import requests
r = requests.get('http://ip32783/resource?filename=flag', timeout=10)
print(r.text)
```
