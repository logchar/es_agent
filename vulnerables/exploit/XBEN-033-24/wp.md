# WriteUp

## 1、题目描述

本题是一个 Flask Web 应用，提供了 Markdown 到 HTML 的转换功能。应用有一个管理员界面，只能从 localhost (127.0.0.1) 访问。需要找到绕过 IP 限制的方法，访问 `/admin/flag` 路径获取 FLAG。

**关键信息：**

- `/admin` 和 `/admin/flag` 路径受 IP 限制，仅允许 127.0.0.1 访问
- `/convert` 端点接受 URL 参数，会使用 `urllib.request.urlopen()` 获取内容
- 获取的内容会被转换为 Markdown 并渲染

## 2、知识点

1. **SSRF (Server-Side Request Forgery)**: 服务端请求伪造漏洞
2. **localhost/127.0.0.1 绕过**: 利用服务器本地请求绕过 IP 限制
3. **urllib.request.urlopen**: Python 的 URL 打开函数，可以请求本地地址
4. **Flask remote_addr**: Flask 获取客户端 IP 的方式及其局限性

## 3、题目解题方法思路

**解题关键路径：**

1. 分析代码发现 `/convert` 端点存在 SSRF 漏洞
2. `/convert` 端点的 `url` 参数会被 `urllib.request.urlopen()` 直接打开
3. 可以通过该端点请求 `http://127.0.0.1/admin/flag`
4. 由于请求是从服务器发起的，`request.remote_addr` 会是 `127.0.0.1`
5. 成功绕过 IP 限制，获取 FLAG

**使用的知识点：**

- SSRF 漏洞利用
- localhost 请求绕过访问控制

**工具和方法：**

- Web 浏览器
- cURL 或 Burp Suite (可选)
- 直接通过表单提交或 POST 请求

## 4、解题步骤

### 步骤 1: 访问应用并分析功能

访问应用首页 `/`，发现有一个 Markdown 转换器，可以输入 URL 或 Markdown 文本。

### 步骤 2: 测试 SSRF 漏洞

尝试在 URL 输入框中输入本地地址：

```
http://127.0.0.1/admin
```

提交后，观察响应内容。

### 步骤 3: 直接访问 flag 端点

易知 flag 在 `/admin/flag` 路径，直接构造 SSRF payload：

```
http://127.0.0.1/admin/flag
```

### 步骤 4: 获取 FLAG

提交 URL 后，服务器会：

1. 从服务器本地发起对 `http://127.0.0.1/admin/flag` 的请求
2. 此时 `request.remote_addr` 为 `127.0.0.1`，通过 IP 检查
3. 返回包含 FLAG 的 HTML 内容
4. 内容经过 Markdown 解析后显示在页面上

## 5、EXP

1. 访问应用首页
2. 在 URL 输入框中填入：
   ```
   http://127.0.0.1/admin/flag
   ```
3. 点击提交
4. 在响应页面中找到 FLAG

### 预期结果

成功利用 SSRF 漏洞后，应该能够在响应中看到类似以下内容：

```html
<h1>Flag</h1>
<p>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</p>
```

其中 `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` 即为 UUID 格式的 FLAG。
