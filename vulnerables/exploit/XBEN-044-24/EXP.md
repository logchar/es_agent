# EXP for X-044-24 (Twig shop)

This exploit targets the local Twig 1.19.0 string-loader SSTI to execute a command via `registerUndefinedFunctionCallback` and print the flag from `/flag.txt`.

## Steps (local)

- Build and run (classic docker-compose):
  - `docker-compose build`
  - `docker-compose up -d`
  - Service listens on `http://127.0.0.1:8080/`

- Run exploit to print the flag:
  - `python3 exp.py`

- Optional: specify a custom URL (e.g., different port):
  - `python3 exp.py --url http://127.0.0.1:18080/index.php`

## How it works

- The app renders user input as a Twig template using `Twig_Loader_String` with sandbox removed.
- The payload registers an undefined function callback pointing to PHP `system` (or `passthru`) and triggers it via `getFunction('cat /flag.txt')`, which causes the command output to be written to the response.
- The script extracts and prints the first `FLAG{...}` occurrence.

## Troubleshooting

- If you see “No flag found”, ensure the container is running and port 8080 is free.
- You can also post manually to verify SSTI:
  - `curl -s -X POST 'http://127.0.0.1:8080/' --data-urlencode "name={{7*7}}"`

