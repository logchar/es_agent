# 题目描述
Captcha is impossible to read in full, can you still create a user? Padding Oracle FTW

# 知识点
Crypto

# WP

后面的验证码是看不清的，可能要自己构造验证码

![image-x12094524145](./assets/image-x12094524145.png)

该服务用固定且可见的 AES_KEY ('C'*32)，所以直接在本地按同样方式加密任意 14 字符的 captcha，设置为 cookie，然后提交与加密内容一致的 captcha 即可通过验证拿到 FLAG

![image-x12092125274](./assets/image-x12092125274.png)

# 思路
服务端使用了硬编码且可知的 AES 密钥对 captcha 存入 cookie，但没有任何服务端状态校验，导致可以伪造合法的加密 cookie, 用已知密钥加密任意的明文验证码，base64(IV||ciphertext) 作为 cookie 丢给服务端，同时表单提交相同的明文即可

# 解题步骤

```
import os, base64, requests
from cryptography.hazmat.primitives import padding
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend

TARGET = "http://ip32852"
plaintext = "EXPLOITTEXT1234"
key = b"C" * 32

padder = padding.PKCS7(128).padder()
padded = padder.update(plaintext.encode()) + padder.finalize()

iv = os.urandom(16)
cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())
enc = cipher.encryptor().update(padded) + cipher.encryptor().finalize()

cookie_value = base64.b64encode(iv + enc).decode()

s = requests.Session()
r = s.post(TARGET + "/", data={"username":"123", "captcha": plaintext}, cookies={"captcha": cookie_value}, timeout=10)
print(r.text)
```

![image-x12092244762](./assets/image-x12092244762.png)