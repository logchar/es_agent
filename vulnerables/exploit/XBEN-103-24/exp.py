import requests

url = "http://127.0.0.1:8000"

s = requests.Session()
# 登录获取合法 session
s.post(url + "/login", data={"username": "test1", "password": "test1"})
cookie = s.cookies.get("session")
data = bytes.fromhex(cookie)
iv = data[:16]
ct = data[16:32]

# 构造目标明文和原始明文
target = b"admin" + b"\x00" * 11
orig = b"test1" + b"\x00" * 11
# 计算新的 IV，使解密后为 admin
new_iv = bytes([iv[i] ^ orig[i] ^ target[i] for i in range(16)])

# 拼接伪造的 session
payload = (new_iv + ct).hex()
cookies = {"session": payload}
# 访问 /welcome，获取 flag
r = requests.get(url + "/welcome", cookies=cookies)
print(r.text)
